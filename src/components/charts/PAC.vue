<script setup>
import { onMounted, onUpdated, reactive, computed } from 'vue'
import { getCoinTickersById } from '../../services/api'
import { getStorage } from '../../utils/cache'

const chart = reactive({
  options: {
    chart: {
      id: 'vuechart-example',
    },
    xaxis: {
      // type: 'datetime',
      // categories: [1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
      categories: [
        "2024-11-26T07:25:40.000Z",
        "2024-11-26T07:50:24.000Z",
        "2024-11-26T08:00:45.000Z",
        "2024-11-26T08:01:47.000Z",
        "2024-11-26T08:06:43.000Z",
        "2024-11-26T08:23:16.000Z",
        "2024-11-26T08:24:27.000Z",
        "2024-11-26T08:26:26.000Z",
        "2024-11-26T08:33:14.000Z",
        "2024-11-26T08:40:46.000Z",
        "2024-11-26T08:42:47.000Z",
        "2024-11-26T08:59:45.000Z",
        "2024-11-26T09:01:54.000Z",
        "2024-11-26T09:21:08.000Z",
        "2024-11-26T09:24:59.000Z",
        "2024-11-26T09:36:14.000Z",
        "2024-11-26T09:55:49.000Z",
        "2024-11-26T09:56:40.000Z",
        "2024-11-26T09:56:47.000Z",
        "2024-11-26T10:01:33.000Z",
        "2024-11-26T10:03:11.000Z",
        "2024-11-26T10:12:38.000Z",
        "2024-11-26T10:32:06.000Z",
        "2024-11-26T10:37:50.000Z",
        "2024-11-26T10:41:09.000Z",
        "2024-11-26T10:55:51.000Z",
        "2024-11-26T11:01:38.000Z",
        "2024-11-26T11:10:55.000Z",
        "2024-11-26T11:11:07.000Z",
        "2024-11-26T11:17:40.000Z",
        "2024-11-26T11:30:42.000Z",
        "2024-11-26T11:32:04.000Z",
        "2024-11-26T11:34:40.000Z",
        "2024-11-26T12:00:15.000Z",
        "2024-11-26T12:01:45.000Z",
        "2024-11-26T12:05:57.000Z",
        "2024-11-26T12:12:43.000Z",
        "2024-11-26T12:18:02.000Z",
        "2024-11-26T12:18:48.000Z",
        "2024-11-26T12:20:42.000Z",
        "2024-11-26T12:21:42.000Z",
        "2024-11-26T12:33:11.000Z",
        "2024-11-26T12:36:44.000Z",
        "2024-11-26T12:37:25.000Z",
        "2024-11-26T13:04:49.000Z",
        "2024-11-26T13:04:58.000Z",
        "2024-11-26T13:11:52.000Z",
        "2024-11-26T13:23:47.000Z",
        "2024-11-26T13:25:29.000Z",
        "2024-11-26T13:28:06.000Z",
        "2024-11-26T13:31:52.000Z",
        "2024-11-26T13:34:53.000Z",
        "2024-11-26T13:36:01.000Z",
        "2024-11-26T13:45:49.000Z",
        "2024-11-26T13:51:46.000Z",
        "2024-11-26T14:01:52.000Z",
        "2024-11-26T14:03:54.000Z",
        "2024-11-26T14:04:53.000Z",
        "2024-11-26T14:06:53.000Z",
        "2024-11-26T14:06:55.000Z",
        "2024-11-26T14:13:15.000Z",
        "2024-11-26T14:13:57.000Z",
        "2024-11-26T14:18:51.000Z",
        "2024-11-26T14:22:50.000Z",
        "2024-11-26T14:37:55.000Z",
        "2024-11-26T14:39:51.000Z",
        "2024-11-26T14:48:45.000Z",
        "2024-11-26T14:49:15.000Z",
        "2024-11-26T14:49:19.000Z",
        "2024-11-26T14:54:12.000Z",
        "2024-11-26T14:54:34.000Z",
        "2024-11-26T15:01:30.000Z",
        "2024-11-26T15:01:42.000Z",
        "2024-11-26T15:02:41.000Z",
        "2024-11-26T15:05:01.000Z",
        "2024-11-26T15:09:35.000Z",
        "2024-11-26T15:10:11.000Z",
        "2024-11-26T15:11:16.000Z",
        "2024-11-26T15:12:10.000Z",
        "2024-11-26T15:12:11.000Z",
        "2024-11-26T15:12:12.000Z",
        "2024-11-26T15:12:13.000Z",
        "2024-11-26T15:12:14.000Z",
        "2024-11-26T15:12:15.000Z",
        "2024-11-26T15:12:16.000Z",
        "2024-11-26T15:12:56.000Z",
        "2024-11-26T15:12:58.000Z",
        "2024-11-26T15:13:01.000Z",
        "2024-11-26T15:13:14.000Z"
      ]
    },
    title: {
      text: 'Bitcoin Prices',
      align: 'left'
    },
  },
  series: [{
    name: 'series-1',
    // data: [30, 40, 45, 50, 49, 60, 70, 91]
    data: [
      3e-8,
      1.1e-7,
      0.0000010007355908581,
      8e-7,
      2e-8,
      2.5e-7,
      3e-8,
      5e-8,
      0.0000012,
      2e-8,
      1e-8,
      4e-8,
      6.6e-7,
      2.411e-7,
      3e-7,
      1.31e-9,
      4e-8,
      0.00001805,
      2e-8,
      0.0000015,
      0.00000947,
      2.5e-7,
      1.9e-7,
      4e-8,
      4e-8,
      6e-8,
      0.032919,
      0.00000334,
      0.000005532,
      3.5e-7,
      0.00001557,
      0.00001557,
      0.00008,
      7.6e-8,
      0.00000111,
      3.5e-7,
      1.2e-7,
      4.3e-8,
      3e-7,
      0.00000531,
      6e-8,
      5e-8,
      5.4e-7,
      0.00000556,
      1.7e-7,
      5.5e-9,
      3.1e-7,
      3e-8,
      3.3e-10,
      0.000011062,
      3e-8,
      0.000001,
      0.000011062,
      0.03312,
      0.0000049,
      1.7e-7,
      2.7e-8,
      8.3000321398921e-9,
      2.2e-7,
      3e-8,
      0.00000399,
      0.00005302,
      0.00000757,
      0.001683,
      0.0000108,
      7.2e-7,
      3e-8,
      0.0000025,
      0.0003023,
      2e-15,
      0.000006332,
      0.0003058,
      2.51e-7,
      0.02818,
      5e-9,
      6.32e-7,
      0.000014632611090484577,
      6.8e-10,
      4.063e-10,
      2.136e-9,
      8.3e-7,
      7.7e-8,
      6.7e-8,
      1.2e-8,
      144078.13416733444,
      3.39e-7,
      8.04e-8,
      0.00000475,
      6.33e-7
    ]
  }]
})

const options = computed(() => chart.options)
const series = computed(() => chart.series)


const add = () => {
  // Add random number between 30 and 100 to series data
  series[0].data.push(Math.floor(Math.random() * 100))

  // Get last year and add next year to categories
  const lastYear = options.xaxis.categories[options.xaxis.categories.length - 1]
  options.xaxis.categories.push(lastYear + 1)
}

const getCoins = () => {
  getCoinTickersById({ id: 'bitcoin' })
}

const getLocalStorage = () => {
  const coins = getStorage('bitcoin')
  const keys = Object.keys(coins.data)
    .sort((a, b) => a - b)

  const categories = []
  const series = []
  keys.forEach(key => {
    const date = new Date(parseInt(key)).toISOString()
    categories.push(date)
    series.push(coins.data[key])
  });

  // chart.options.xaxis.categories = categories
  // chart.series[0].data = series

}

</script>

<template>
  <div>
    <h4>PAC</h4>
    <apexchart width="500" type="line" :options="options" :series="series"></apexchart>
    <button @click="add">add</button>
    <button @click="getCoins">get coins</button>
    <button @click="getLocalStorage">get storage</button>
  </div>
</template>

<style scoped></style>