<script setup>
import { onMounted, onUpdated, reactive, computed, ref } from 'vue'
import Filters from '../filters/Filters.vue'
import { getCoinTickersById } from '../../services/api'
import { getStorage } from '../../utils/cache'

const chart = reactive({
  options: {
    chart: {
      id: 'vuechart-example',
    },
    xaxis: {
      type: 'datetime',
      // categories: [1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998]
    },
    title: {
      text: 'Bitcoin Prices',
      align: 'left'
    },
  },
  series: [{
    name: 'series-1',
    data: []
    // data: [30, 40, 45, 50, 49, 60, 70, 91]
    // data: [
    //   [
    //     1732639842000,
    //     0.00005302
    //   ],
    //   [
    //     1732634794000,
    //     90000.02
    //   ],
    //   [
    //     1732640331000,
    //     0.03538
    //   ],
    //   [
    //     1732640512000,
    //     0.000014695006562787998
    //   ],
    //   [
    //     1732640336000,
    //     0.001010997020195837
    //   ],
    //   [
    //     1732640512000,
    //     0.0009752289661647387
    //   ],
    //   [
    //     1732640451000,
    //     145675.03209754964
    //   ],
    //   [
    //     1732623544000,
    //     3.3e-7
    //   ],
    //   [
    //     1732637002000,
    //     0.0000013
    //   ],
    //   [
    //     1732629106000,
    //     0.0000049
    //   ],
    //   [
    //     1732612174000,
    //     4.9e-8
    //   ],
    //   [
    //     1732615293000,
    //     0.0000015
    //   ],
    //   [
    //     1732624645000,
    //     0.00000556
    //   ],
    //   [
    //     1732640490000,
    //     1.35e-7
    //   ],
    //   [
    //     1732640376000,
    //     3.39e-7
    //   ],
    //   [
    //     1732640506000,
    //     0.00000475
    //   ],
    //   [
    //     1732623482000,
    //     4.3e-8
    //   ],
    //   [
    //     1732622415000,
    //     7.6e-8
    //   ],
    //   [
    //     1732640490000,
    //     8.3e-7
    //   ],
    //   [
    //     1732640503000,
    //     8.04e-8
    //   ],
    //   [
    //     1732640490000,
    //     0.00000389
    //   ],
    //   [
    //     1732619860000,
    //     3.5e-7
    //   ],
    //   [
    //     1732613099000,
    //     3e-7
    //   ],
    //   [
    //     1732640493000,
    //     2.11e-7
    //   ],
    //   [
    //     1732630970000,
    //     0.001683
    //   ],
    //   [
    //     1732637685000,
    //     0.000085
    //   ],
    //   [
    //     1732638268000,
    //     2.5423e-9
    //   ],
    //   [
    //     1732640490000,
    //     5.01e-8
    //   ],
    //   [
    //     1732615958000,
    //     2.5e-7
    //   ],
    //   [
    //     1732620880000,
    //     0.00008
    //   ],
    //   [
    //     1732622757000,
    //     3.5e-7
    //   ],
    //   [
    //     1732639233000,
    //     1.2e-7
    //   ],
    //   [
    //     1732628161000,
    //     0.000011062
    //   ],
    //   [
    //     1732640502000,
    //     8.6e-8
    //   ],
    //   [
    //     1732615274000,
    //     2.585e-7
    //   ],
    //   [
    //     1732639234000,
    //     4e-8
    //   ],
    //   [
    //     1732623702000,
    //     6e-8
    //   ],
    //   [
    //     1732619455000,
    //     0.00000334
    //   ],
    //   [
    //     1732615000000,
    //     0.00001805
    //   ],
    //   [
    //     1732638516000,
    //     0.00000399
    //   ],
    //   [
    //     1732640489000,
    //     3.535e-8
    //   ],
    //   [
    //     1732631875000,
    //     0.0000108
    //   ],
    //   [
    //     1732629712000,
    //     1.7e-7
    //   ],
    //   [
    //     1732629834000,
    //     2.7e-8
    //   ],
    //   [
    //     1732638671000,
    //     0.00000399
    //   ],
    //   [
    //     1732635224000,
    //     0.000006332
    //   ],
    //   [
    //     1732635318000,
    //     0.000006332
    //   ],
    //   [
    //     1732630015000,
    //     3e-8
    //   ],
    //   [
    //     1732640330000,
    //     2.9e-7
    //   ],
    //   [
    //     1732618898000,
    //     0.032919
    //   ],
    //   [
    //     1732638117000,
    //     5e-9
    //   ],
    //   [
    //     1732634164000,
    //     7.2e-7
    //   ],
    //   [
    //     1732634863000,
    //     2.57e-7
    //   ],
    //   [
    //     1732640489000,
    //     5.11e-9
    //   ],
    //   [
    //     1732638357000,
    //     0.000001
    //   ],
    //   [
    //     1732633998000,
    //     6.33e-7
    //   ],
    //   [
    //     1732634028000,
    //     6.33e-7
    //   ],
    //   [
    //     1732622505000,
    //     0.00000111
    //   ],
    //   [
    //     1732638251000,
    //     0.00000947
    //   ],
    //   [
    //     1732636648000,
    //     0.00001537
    //   ],
    //   [
    //     1732620898000,
    //     0.00855441
    //   ],
    //   [
    //     1732638257000,
    //     0.00000637
    //   ],
    //   [
    //     1732629893000,
    //     8.3000321398921e-9
    //   ],
    //   [
    //     1732640502000,
    //     2e-8
    //   ],
    //   [
    //     1732639192000,
    //     3e-8
    //   ],
    //   [
    //     1732639363000,
    //     3e-8
    //   ],
    //   [
    //     1732640474000,
    //     0.00030182
    //   ],
    //   [
    //     1732633361000,
    //     0.02818
    //   ],
    //   [
    //     1732614949000,
    //     4e-8
    //   ],
    //   [
    //     1732640440000,
    //     6.8e-10
    //   ],
    //   [
    //     1732640489000,
    //     4.063e-10
    //   ],
    //   [
    //     1732634698000,
    //     2e-8
    //   ],
    //   [
    //     1732617470000,
    //     4e-8
    //   ],
    //   [
    //     1732640381000,
    //     3.7e-10
    //   ],
    //   [
    //     1732623163000,
    //     1.2e-7
    //   ],
    //   [
    //     1732626289000,
    //     1.7e-7
    //   ],
    //   [
    //     1732632852000,
    //     2e-15
    //   ],
    //   [
    //     1732633501000,
    //     5e-9
    //   ],
    //   [
    //     1732640505000,
    //     0.000001806
    //   ],
    //   [
    //     1732634274000,
    //     4.3e-7
    //   ],
    //   [
    //     1732633290000,
    //     0.0003058
    //   ],
    //   [
    //     1732640491000,
    //     2.136e-9
    //   ],
    //   [
    //     1732635174000,
    //     4e-8
    //   ],
    //   [
    //     1732640494000,
    //     6.7e-8
    //   ],
    //   [
    //     1732634936000,
    //     3e-8
    //   ],
    //   [
    //     1732627427000,
    //     3e-8
    //   ],
    //   [
    //     1732624391000,
    //     5e-8
    //   ],
    //   [
    //     1732640509000,
    //     7.5e-9
    //   ],
    //   [
    //     1732613774000,
    //     1.31e-9
    //   ],
    //   [
    //     1732619467000,
    //     0.000005532
    //   ],
    //   [
    //     1732620417000,
    //     0.00000186
    //   ],
    //   [
    //     1732626968000,
    //     0.000037
    //   ],
    //   [
    //     1732631082000,
    //     0.0000033
    //   ],
    //   [
    //     1732633503000,
    //     1e-8
    //   ],
    //   [
    //     1732634196000,
    //     0.000001289
    //   ],
    //   [
    //     1732631447000,
    //     2.9e-7
    //   ],
    //   [
    //     1732639706000,
    //     9.1e-7
    //   ],
    //   [
    //     1732633344000,
    //     0.00000291
    //   ],
    //   [
    //     1732621064000,
    //     91000.000001
    //   ],
    //   [
    //     1732640436000,
    //     9.33e-10
    //   ]
    // ]
  }]
})

const options = computed(() => chart.options)
const series = computed(() => chart.series)

const interval = ref(7)

const add = () => {
  // Add random number between 30 and 100 to series data
  series[0].data.push(Math.floor(Math.random() * 100))

  // Get last year and add next year to categories
  const lastYear = options.xaxis.categories[options.xaxis.categories.length - 1]
  options.xaxis.categories.push(lastYear + 1)
}

const getCoins = () => {
  getCoinTickersById({ id: 'bitcoin' })
}

const getLocalStorage = () => {
  const coins = getStorage('bitcoin')
  const keys = Object.keys(coins.data)
  // console.log(coins.data)

  // chart.options.xaxis.categories = categories
  chart.series[0].data = coins.data
}

const updateInterval = (event) => {
  // console.log(event)
  interval.value = event.value
}

</script>

<template>
  <div>
    <h4>PAC</h4>
    <Filters :interval="interval" @update:interval="updateInterval" />
    <apexchart width="500" type="line" :options="options" :series="series"></apexchart>
    <button @click="add">add</button>
    <button @click="getCoins">get coins</button>
    <button @click="getLocalStorage">get storage</button>
  </div>
</template>

<style scoped></style>